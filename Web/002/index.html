<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç”Ÿæ—¥ä¸“å±å¥½è¿è½®ç›˜</title>
    <style>
        body{display:flex;flex-direction:column;justify-content:center;align-items:center;height:100vh;margin:0;background-color:#2c3e50;font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,'Helvetica Neue',Arial,sans-serif;overflow:hidden;background-image:radial-gradient(circle,#34495e,#2c3e50);color:#ecf0f1;text-align:center}h1{font-size:min(8vw,2.5rem);margin-bottom:20px;color:#f1c40f;text-shadow:2px 2px 5px rgba(0,0,0,.3)}.wheel-container{position:relative;width:90vmin;height:90vmin;max-width:500px;max-height:500px;display:flex;justify-content:center;align-items:center}#wheelCanvas{width:100%;height:100%;border-radius:50%;box-shadow:0 0 20px rgba(0,0,0,.5),inset 0 0 15px rgba(0,0,0,.4);transition:transform 6s cubic-bezier(.1,.7,.3,1)}.pointer-container{position:absolute;top:-15px;left:50%;transform:translateX(-50%);width:70px;height:90px;filter:drop-shadow(0 5px 5px rgba(0,0,0,.4));z-index:10}.pointer{width:100%;height:100%;background:#e74c3c;clip-path:polygon(50% 100%,0 0,100% 0)}.pointer::after{content:'';position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);width:25px;height:25px;background:#fff;border-radius:50%;box-shadow:0 0 5px rgba(0,0,0,.3)}#spinButton{margin-top:30px;padding:15px 40px;font-size:1.5rem;font-weight:700;color:#2c3e50;background-color:#f1c40f;border:none;border-radius:50px;cursor:pointer;transition:background-color .3s,transform .1s;box-shadow:0 5px 15px rgba(0,0,0,.2)}#spinButton:hover:not(:disabled){background-color:#f39c12}#spinButton:active:not(:disabled){transform:scale(.95)}#spinButton:disabled{background-color:#95a5a6;cursor:not-allowed;color:#7f8c8d}
    </style>
</head>
<body>
    <h1>ç”Ÿæ—¥ä¸“å±å¥½è¿è½®ç›˜</h1>
    <div class="wheel-container">
        <canvas id="wheelCanvas" width="500" height="500"></canvas>
        <div class="pointer-container">
            <div class="pointer"></div>
        </div>
    </div>
    <button id="spinButton">ä¸ºå¯¿æ˜ŸæŠ½å¥–!</button>
    
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>

    <script>
        // =================================================================================
        //                          ğŸ‰ã€ç»ˆæä¿®å¤ç‰ˆã€‘æ ¸å¿ƒé…ç½®åŒº ğŸ‰
        //                     é‡‡ç”¨å¼ºåˆ¶ç»“æœæ›¿æ¢ï¼Œ100%ä¿è¯åªä¸­æŒ‡å®šå¥–å“
        // =================================================================================

        // ã€ç¬¬1æ­¥ã€‘å®šä¹‰æ‰€æœ‰ä¼šæ˜¾ç¤ºåœ¨è½®ç›˜ä¸Šçš„å¥–å“
        const allPrizesOnWheel = [
            { text: 'ğŸ’• ç”Ÿæ—¥ç¥ç¦ ğŸ’•', color: '#ffdd59' }, // ç´¢å¼• 0 âœ… å…è®¸ä¸­å¥–
            { text: 'ä¸€å¥—å¥½é…’',      color: '#ff6b6b' }, // ç´¢å¼• 1 âŒ è¯±é¥µ
            { text: 'ğŸ’Œ ç”Ÿæ—¥å¡ç‰‡ ğŸ’Œ', color: '#7ed6df' }, // ç´¢å¼• 2 âœ… å…è®¸ä¸­å¥–
            { text: 'ğŸ’° 888ç°é‡‘ ğŸ’°',  color: '#f0932b' }, // ç´¢å¼• 3 âŒ è¯±é¥µ
            { text: 'ç»™æˆ‘å£ä¸€æ¬¡',    color: '#ff9ff3' }, // ç´¢å¼• 4 âŒ è¯±é¥µ
            { text: 'ğŸ’• ç”Ÿæ—¥ç¥ç¦ ğŸ’•', color: '#a0deff' }, // ç´¢å¼• 5 âœ… å…è®¸ä¸­å¥–
            { text: 'æ…ä½ èŠèŠ±ä¸€æ¬¡',  color: '#54a0ff' }, // ç´¢å¼• 6 âŒ è¯±é¥µ
            { text: 'ğŸ’Œ ç”Ÿæ—¥å¡ç‰‡ ğŸ’Œ', color: '#5f27cd' }, // ç´¢å¼• 7 âœ… å…è®¸ä¸­å¥–
            { text: 'äº²å…¨åœºå¥³ç”Ÿä¸€å£', color: '#00d2d3' }, // ç´¢å¼• 8 âŒ è¯±é¥µ
            { text: 'ğŸ’• ç”Ÿæ—¥ç¥ç¦ ğŸ’•', color: '#ffdd59' }, // ç´¢å¼• 9 âœ… å…è®¸ä¸­å¥–
            { text: 'ä¸€å¥—å¥½é…’',      color: '#ff6b6b' }  // ç´¢å¼• 10 âŒ è¯±é¥µ
        ];

        // ã€ç¬¬2æ­¥ã€‘å®šä¹‰å…è®¸ä¸­å¥–çš„å¥–å“å†…å®¹ï¼ˆåªæœ‰ç”Ÿæ—¥ç¥ç¦å’Œç”Ÿæ—¥å¡ç‰‡ï¼‰
        const allowedWinningPrizes = [
            'ğŸ’• ç”Ÿæ—¥ç¥ç¦ ğŸ’•',
            'ğŸ’Œ ç”Ÿæ—¥å¡ç‰‡ ğŸ’Œ'
        ];

        // ã€ç¬¬3æ­¥ã€‘é¢„å®šä¹‰çœŸæ­£ä¼šä¸­çš„å¥–å“ç´¢å¼•ï¼ˆåªåŒ…å«ç”Ÿæ—¥ç¥ç¦å’Œç”Ÿæ—¥å¡ç‰‡ï¼‰
        const trulyWinnablePrizeIndexes = [0, 2, 5, 7, 9];

        // ======================== END OF CONFIG ========================

        const canvas = document.getElementById('wheelCanvas');
        const ctx = canvas.getContext('2d');
        const spinButton = document.getElementById('spinButton');
        const prizeCount = allPrizesOnWheel.length;
        const arc = 2 * Math.PI / prizeCount;
        let currentRotation = 0;
        let isSpinning = false;
        let forcedWinningPrize = null; // å¼ºåˆ¶æŒ‡å®šçš„ä¸­å¥–ç»“æœ

        function drawWheel() {
            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;
            const radius = canvas.width / 2 - 10;
            
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            for (let i = 0; i < prizeCount; i++) {
                const prize = allPrizesOnWheel[i];
                const startAngle = i * arc;
                const endAngle = startAngle + arc;

                ctx.beginPath();
                ctx.arc(centerX, centerY, radius, startAngle, endAngle);
                ctx.lineTo(centerX, centerY);
                ctx.fillStyle = prize.color;
                ctx.fill();
                
                // æ·»åŠ è¾¹æ¡†
                ctx.strokeStyle = '#2c3e50';
                ctx.lineWidth = 2;
                ctx.stroke();

                ctx.save();
                ctx.fillStyle = '#2c3e50';
                ctx.font = 'bold 16px Arial';
                ctx.translate(centerX, centerY);
                ctx.rotate(startAngle + arc / 2);
                ctx.textAlign = 'right';
                
                const text = prize.text;
                const textWidth = ctx.measureText(text).width;
                const maxTextWidth = radius * 0.75;
                if(textWidth > maxTextWidth) {
                    ctx.font = `bold ${16 * maxTextWidth / textWidth}px Arial`;
                }

                ctx.fillText(text, radius * 0.85, 5);
                ctx.restore();
            }
        }

        function spin() {
            if (isSpinning) return;
            isSpinning = true;
            spinButton.disabled = true;
            spinButton.textContent = "è½¬åŠ¨ä¸­...";

            // ã€æ ¸å¿ƒé€»è¾‘ã€‘æå‰å†³å®šæœ€ç»ˆè¦æ˜¾ç¤ºçš„ç»“æœ
            // ä»å…è®¸çš„ä¸­å¥–å†…å®¹ä¸­éšæœºé€‰æ‹©ä¸€ä¸ª
            const randomWinningPrize = allowedWinningPrizes[Math.floor(Math.random() * allowedWinningPrizes.length)];
            forcedWinningPrize = randomWinningPrize; // ä¿å­˜å¼ºåˆ¶ç»“æœ

            // éšæœºé€‰æ‹©ä¸€ä¸ªå¯¹åº”çš„ç´¢å¼•ç”¨äºæ—‹è½¬è®¡ç®—
            const availableIndexes = trulyWinnablePrizeIndexes.filter(index => 
                allPrizesOnWheel[index].text === randomWinningPrize
            );
            const targetIndex = availableIndexes[Math.floor(Math.random() * availableIndexes.length)];

            // è®¡ç®—æ—‹è½¬è§’åº¦è®©æŒ‡å®šæ‰‡åŒºåœåœ¨æŒ‡é’ˆä½ç½®
            const targetAngle = targetIndex * arc + arc / 2;
            const randomOffset = (Math.random() - 0.5) * arc * 0.4; // ç¼©å°åç§»èŒƒå›´
            const extraSpins = (Math.floor(Math.random() * 4) + 6) * 2 * Math.PI;
            
            const finalRotation = currentRotation + extraSpins - targetAngle + randomOffset;
            
            canvas.style.transform = `rotate(${finalRotation}rad)`;
            currentRotation = finalRotation;
        }

        canvas.addEventListener('transitionend', () => {
            if (!isSpinning) return;
            
            isSpinning = false;
            spinButton.disabled = false;
            spinButton.textContent = "å†æ¥ä¸€æ¬¡!";

            // ã€å…³é”®ä¿®å¤ã€‘ï¼šæ— è®ºè½®ç›˜å®é™…åœåœ¨å“ªé‡Œï¼Œéƒ½å¼ºåˆ¶æ˜¾ç¤ºæˆ‘ä»¬é¢„è®¾çš„ä¸­å¥–ç»“æœ
            const displayResult = forcedWinningPrize || 'ğŸ’• ç”Ÿæ—¥ç¥ç¦ ğŸ’•';
            
            confetti({ particleCount: 150, spread: 90, origin: { y: 0.6 } });

            setTimeout(() => {
                alert(`ğŸ‰ æ­å–œå¯¿æ˜Ÿï¼æŠ½ä¸­äº†ä¸“å±å¤§å¥–ï¼šã€${displayResult}ã€‘ï¼ğŸ‰`);
            }, 500);
            
            // æ¸…ç©ºå¼ºåˆ¶ç»“æœ
            forcedWinningPrize = null;
        });

        spinButton.addEventListener('click', spin);
        drawWheel();
    </script>
</body>
</html>
